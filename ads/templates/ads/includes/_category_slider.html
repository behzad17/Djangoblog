{% load static %}
{% load ads_extras %}
{% comment %}
  Ads Category Slider Partial - Image-Based Center-Mode Navigation
  
  Usage:
    {% include 'ads/includes/_category_slider.html' with categories=categories ad_counts=ad_counts active_category_slug=active_category_slug %}
  
  Parameters:
    - categories: Queryset of AdCategory objects
    - ad_counts: Dictionary {category_id: count}
    - active_category_slug: Optional slug of currently active category
{% endcomment %}

<div class="ads-category-slider" 
     data-ads-slider 
     role="region" 
     aria-label="Ads category navigation slider"
     aria-live="polite">
  
  <!-- Navigation Buttons -->
  <div class="ads-slider-controls">
    <button type="button"
            data-ads-prev
            class="ads-nav-btn"
            aria-label="Previous category"
            aria-controls="ads-slider-track">
      ‹
    </button>
    
    <button type="button"
            data-ads-next
            class="ads-nav-btn"
            aria-label="Next category"
            aria-controls="ads-slider-track">
      ›
    </button>
  </div>

  <!-- Track Container -->
  <div class="ads-slider-wrapper">
    <div data-ads-track 
         id="ads-slider-track"
         class="ads-slider-track"
         role="list"
         aria-label="Category list">
      
      {% for category in categories %}
        {% with ad_count=ad_counts|get_item:category.id|default:0 %}
          {% with image_path=category|category_image_path %}
            {% if image_path %}
              <article class="ads-project-card"
                       data-ads-card
                       data-ads-card-index="{{ forloop.counter0 }}"
                       {% if active_category_slug == category.slug %}active{% endif %}
                       role="listitem">
                
                <!-- Background Image -->
                <img class="ads-project-card__bg" 
                     src="{% static image_path %}" 
                     alt="{{ category.name }}"
                     loading="lazy">
                
                <!-- Card Content -->
                <div class="ads-project-card__content">
                  <!-- Thumbnail (shown only when active) -->
                  <img class="ads-project-card__thumb" 
                       src="{% static image_path %}" 
                       alt="{{ category.name }}"
                       loading="lazy">
                  
                  <div class="ads-project-card__info">
                    <h3 class="ads-project-card__title">{{ category.name }}</h3>
                    
                    {% if category.description %}
                      <p class="ads-project-card__desc">{{ category.description|truncatewords:12 }}</p>
                    {% endif %}
                    
                    <div class="ads-project-card__meta">
                      <span class="ads-project-card__count">{{ ad_count }} آگهی</span>
                    </div>
                    
                    <a href="{% url 'ads:ads_by_category' category.slug %}" 
                       class="ads-project-card__btn"
                       aria-label="Browse {{ category.name }} category ({{ ad_count }} ads)">
                      مشاهده دسته‌بندی
                    </a>
                  </div>
                </div>
              </article>
            {% endif %}
          {% endwith %}
        {% endwith %}
      {% empty %}
        <div class="col-12 text-center">
          <p class="text-muted">هنوز دسته‌بندی راهنمایی تعریف نشده است.</p>
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- Dots Indicator -->
  <div class="ads-slider-dots" data-ads-dots id="ads-slider-dots"></div>
</div>
