{% load static %}
{% load ads_extras %}
{% comment %}
  Ads Category Slider Partial - Center-Mode Navigation
  
  Usage:
    {% include 'ads/includes/_category_slider.html' with categories=categories ad_counts=ad_counts active_category_slug=active_category_slug %}
  
  Parameters:
    - categories: Queryset of AdCategory objects
    - ad_counts: Dictionary {category_id: count}
    - active_category_slug: Optional slug of currently active category
{% endcomment %}

<div class="ads-category-slider" 
     data-ads-slider 
     role="region" 
     aria-label="Ads category navigation slider"
     aria-live="polite">
  
  <!-- Navigation Buttons -->
  <button type="button"
          data-ads-prev
          aria-label="Previous category"
          aria-controls="ads-slider-track">
    ‹
  </button>
  
  <button type="button"
          data-ads-next
          aria-label="Next category"
          aria-controls="ads-slider-track">
    ›
  </button>

  <!-- Track Container -->
  <div data-ads-track 
       id="ads-slider-track"
       class="slider-track-fallback"
       role="list"
       aria-label="Category list">
    
    {% for category in categories %}
      {% with ad_count=ad_counts|get_item:category.id|default:0 %}
        {% with is_active=active_category_slug == category.slug %}
          
          <!-- Determine accent color and icon, then render card -->
          {% if 'leisure' in category.slug|lower or 'اوقات' in category.name or 'فراغت' in category.name %}
            <a href="{% url 'ads:ads_by_category' category.slug %}" 
               data-ads-card
               data-ads-card-index="{{ forloop.counter0 }}"
               class="slider-card"
               style="--accent: #5E9CA0;"
               aria-label="Browse {{ category.name }} category ({{ ad_count }} ads)"
               {% if is_active %}aria-current="page"{% endif %}
               role="listitem">
              
              <div class="slider-card-icon">
                <i class="fas fa-calendar-alt" aria-hidden="true"></i>
              </div>
              
              <div class="slider-card-name">{{ category.name }}</div>
              
              {% if category.description %}
                <div class="slider-card-description">{{ category.description|truncatewords:15 }}</div>
              {% endif %}
              
              <div class="slider-card-count">
                <span class="slider-card-count-badge">{{ ad_count }} آگهی</span>
              </div>
            </a>
            
          {% elif 'legal' in category.slug|lower or 'finance' in category.slug|lower or 'حقوقی' in category.name or 'مالی' in category.name %}
            <a href="{% url 'ads:ads_by_category' category.slug %}" 
               data-ads-card
               data-ads-card-index="{{ forloop.counter0 }}"
               class="slider-card"
               style="--accent: #7B6DAA;"
               aria-label="Browse {{ category.name }} category ({{ ad_count }} ads)"
               {% if is_active %}aria-current="page"{% endif %}
               role="listitem">
              
              <div class="slider-card-icon">
                <i class="fas fa-gavel" aria-hidden="true"></i>
              </div>
              
              <div class="slider-card-name">{{ category.name }}</div>
              
              {% if category.description %}
                <div class="slider-card-description">{{ category.description|truncatewords:15 }}</div>
              {% endif %}
              
              <div class="slider-card-count">
                <span class="slider-card-count-badge">{{ ad_count }} آگهی</span>
              </div>
            </a>
            
          {% elif 'health' in category.slug|lower or 'سلامت' in category.name or 'رفاه' in category.name %}
            <a href="{% url 'ads:ads_by_category' category.slug %}" 
               data-ads-card
               data-ads-card-index="{{ forloop.counter0 }}"
               class="slider-card"
               style="--accent: #7AAE7A;"
               aria-label="Browse {{ category.name }} category ({{ ad_count }} ads)"
               {% if is_active %}aria-current="page"{% endif %}
               role="listitem">
              
              <div class="slider-card-icon">
                <i class="fas fa-heart" aria-hidden="true"></i>
              </div>
              
              <div class="slider-card-name">{{ category.name }}</div>
              
              {% if category.description %}
                <div class="slider-card-description">{{ category.description|truncatewords:15 }}</div>
              {% endif %}
              
              <div class="slider-card-count">
                <span class="slider-card-count-badge">{{ ad_count }} آگهی</span>
              </div>
            </a>
            
          {% elif 'food' in category.slug|lower or 'غذا' in category.name or 'رستوران' in category.name %}
            <a href="{% url 'ads:ads_by_category' category.slug %}" 
               data-ads-card
               data-ads-card-index="{{ forloop.counter0 }}"
               class="slider-card"
               style="--accent: #C28C5C;"
               aria-label="Browse {{ category.name }} category ({{ ad_count }} ads)"
               {% if is_active %}aria-current="page"{% endif %}
               role="listitem">
              
              <div class="slider-card-icon">
                <i class="fas fa-utensils" aria-hidden="true"></i>
              </div>
              
              <div class="slider-card-name">{{ category.name }}</div>
              
              {% if category.description %}
                <div class="slider-card-description">{{ category.description|truncatewords:15 }}</div>
              {% endif %}
              
              <div class="slider-card-count">
                <span class="slider-card-count-badge">{{ ad_count }} آگهی</span>
              </div>
            </a>
            
          {% elif 'housing' in category.slug|lower or 'مسکن' in category.name %}
            <a href="{% url 'ads:ads_by_category' category.slug %}" 
               data-ads-card
               data-ads-card-index="{{ forloop.counter0 }}"
               class="slider-card"
               style="--accent: #6C8FBF;"
               aria-label="Browse {{ category.name }} category ({{ ad_count }} ads)"
               {% if is_active %}aria-current="page"{% endif %}
               role="listitem">
              
              <div class="slider-card-icon">
                <i class="fas fa-home" aria-hidden="true"></i>
              </div>
              
              <div class="slider-card-name">{{ category.name }}</div>
              
              {% if category.description %}
                <div class="slider-card-description">{{ category.description|truncatewords:15 }}</div>
              {% endif %}
              
              <div class="slider-card-count">
                <span class="slider-card-count-badge">{{ ad_count }} آگهی</span>
              </div>
            </a>
            
          {% elif 'home-items' in category.slug|lower or 'وسایل-منزل' in category.slug|lower or 'وسایل منزل' in category.name %}
            <a href="{% url 'ads:ads_by_category' category.slug %}" 
               data-ads-card
               data-ads-card-index="{{ forloop.counter0 }}"
               class="slider-card"
               style="--accent: #9A8F7A;"
               aria-label="Browse {{ category.name }} category ({{ ad_count }} ads)"
               {% if is_active %}aria-current="page"{% endif %}
               role="listitem">
              
              <div class="slider-card-icon">
                <i class="fas fa-couch" aria-hidden="true"></i>
              </div>
              
              <div class="slider-card-name">{{ category.name }}</div>
              
              {% if category.description %}
                <div class="slider-card-description">{{ category.description|truncatewords:15 }}</div>
              {% endif %}
              
              <div class="slider-card-count">
                <span class="slider-card-count-badge">{{ ad_count }} آگهی</span>
              </div>
            </a>
            
          {% elif 'vehicles' in category.slug|lower or 'وسایل-نقلیه' in category.slug|lower or 'وسایل نقلیه' in category.name %}
            <a href="{% url 'ads:ads_by_category' category.slug %}" 
               data-ads-card
               data-ads-card-index="{{ forloop.counter0 }}"
               class="slider-card"
               style="--accent: #7A7F8C;"
               aria-label="Browse {{ category.name }} category ({{ ad_count }} ads)"
               {% if is_active %}aria-current="page"{% endif %}
               role="listitem">
              
              <div class="slider-card-icon">
                <i class="fas fa-car" aria-hidden="true"></i>
              </div>
              
              <div class="slider-card-name">{{ category.name }}</div>
              
              {% if category.description %}
                <div class="slider-card-description">{{ category.description|truncatewords:15 }}</div>
              {% endif %}
              
              <div class="slider-card-count">
                <span class="slider-card-count-badge">{{ ad_count }} آگهی</span>
              </div>
            </a>
            
          {% elif 'work' in category.slug|lower or 'کار' in category.name or 'خدمات' in category.name %}
            <a href="{% url 'ads:ads_by_category' category.slug %}" 
               data-ads-card
               data-ads-card-index="{{ forloop.counter0 }}"
               class="slider-card"
               style="--accent: #7C9AA6;"
               aria-label="Browse {{ category.name }} category ({{ ad_count }} ads)"
               {% if is_active %}aria-current="page"{% endif %}
               role="listitem">
              
              <div class="slider-card-icon">
                <i class="fas fa-briefcase" aria-hidden="true"></i>
              </div>
              
              <div class="slider-card-name">{{ category.name }}</div>
              
              {% if category.description %}
                <div class="slider-card-description">{{ category.description|truncatewords:15 }}</div>
              {% endif %}
              
              <div class="slider-card-count">
                <span class="slider-card-count-badge">{{ ad_count }} آگهی</span>
              </div>
            </a>
            
          {% else %}
            <a href="{% url 'ads:ads_by_category' category.slug %}" 
               data-ads-card
               data-ads-card-index="{{ forloop.counter0 }}"
               class="slider-card"
               style="--accent: #7C9AA6;"
               aria-label="Browse {{ category.name }} category ({{ ad_count }} ads)"
               {% if is_active %}aria-current="page"{% endif %}
               role="listitem">
              
              <div class="slider-card-icon">
                <i class="fas fa-tag" aria-hidden="true"></i>
              </div>
              
              <div class="slider-card-name">{{ category.name }}</div>
              
              {% if category.description %}
                <div class="slider-card-description">{{ category.description|truncatewords:15 }}</div>
              {% endif %}
              
              <div class="slider-card-count">
                <span class="slider-card-count-badge">{{ ad_count }} آگهی</span>
              </div>
            </a>
          {% endif %}
          
        {% endwith %}
      {% endwith %}
    {% empty %}
      <div class="col-12 text-center">
        <p class="text-muted">هنوز دسته‌بندی راهنمایی تعریف نشده است.</p>
      </div>
    {% endfor %}
  </div>
</div>
